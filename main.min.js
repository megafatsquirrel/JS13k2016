document.addEventListener("DOMContentLoaded",function(a){function u(a,b,c,d){for(var e=0;e<a;e++){t[e]=[];for(var f=0;f<b;f++)t[e][f]=C(e*n+p,f*o+q,n,o,r)}}function B(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={left:a,top:b,width:c,height:d,color:e,hasMoved:!1,id:f,location:g,name:h,health:i,movement:j,currentHP:i,weapon:k,armor:l,attack:1*k.damage,attackRange:2,defense:1*l.defense,type:m?"NPC":"PC"};return n}function C(a,b,c,d,e,f){var g={left:a,top:b,width:c,height:d,color:e,gamePieceId:"",isHighlightMove:!1,isHighlightAttack:!1,occupied:!1,occupiedType:"",type:"NORMAL"};return g}function V(){document.addEventListener("mousemove",function(a){R.innerHTML=a.clientX,S.innerHTML=a.clientY}),document.addEventListener("mousedown",function(a){var c=a.clientX-(p+b.parentElement.offsetLeft)+document.scrollingElement.scrollLeft,d=a.clientY-(q+b.parentElement.offsetTop)+document.scrollingElement.scrollTop;if(T.innerHTML=c,U.innerHTML=d,c>=0&&c<=n*l&&d>=0&&d<=o*m){var e=parseInt(c/n),f=parseInt(d/o);if(e>=0&&f>=0&&e<=l&&f<=m){var g=t[e][f];if(void 0!==g&&g.occupied)A.forEach(function(a){a.id===g.gamePieceId&&W(a)});else if(null!==Q){if(!Q.hasMoved&&!g.occupied&&g.isHighlightMove&&"PC"===Q.type)for(var h=0;h<A.length;h++)if(Q.id===A[h].id){var i=A[h];i.left=t[e][f].left,i.top=t[e][f].top,t[i.location.x][i.location.y].occupied=!1,t[i.location.x][i.location.y].occupiedType="",t[i.location.x][i.location.y].gamePieceId="",i.location={x:e,y:f},t[e][f].occupied=!0,t[e][f].occupiedType=i.type,t[e][f].gamePieceId=i.id,A[h].hasMoved=!0,Q=i}A.forEach(function(a){null!==Q&&a.id===Q.id&&aa(a)})}}}else null!==Q&&A.forEach(function(a){null!==Q&&a.id===Q.id&&aa(a)})}),P.addEventListener("click",function(a){for(var b=0;b<A.length;b++)A[b].hasMoved=!1;k++,O.innerHTML=k})}function W(a){null!==Q&&aa(Q),Q=a,a.color="PC"===a.type?h:f,E.innerHTML=a.name,F.innerHTML=a.health+" / "+a.currentHP,K.innerHTML=a.movement,G.innerHTML=a.attack,H.innerHTML=a.defense,I.innerHTML=a.weapon.name,J.innerHTML=a.armor.name,L.innerHTML=a.hasMoved,M.style.display="block",N.style.display="none","PC"===a.type&&(a.hasMoved||X(a,a.movement,!1),X(a,a.attackRange,!0))}function X(a,b,c){for(var d,e,f,g,h=1;h<=b;h++)a.location.x+h<l&&(d=t[a.location.x+h][a.location.y],$(d,a,c),Y(a,b-h,a.location.x+h,!1,c)),a.location.x-h>=0&&(e=t[a.location.x-h][a.location.y],$(e,a,c),Y(a,b-h,a.location.x-h,!0,c)),a.location.y-h>=0&&(f=t[a.location.x][a.location.y-h],$(f,a,c),Z(a,b-h,a.location.y-h,!0,c)),a.location.y+h<m&&(g=t[a.location.x][a.location.y+h],$(g,a,c),Z(a,b-h,a.location.y+h,!1,c))}function Y(a,b,c,d,e){for(var f=1;f<=b;f++)if(d){if(a.location.y-f>=0){var g=t[c][a.location.y-f];$(g,a,e)}}else if(a.location.y+f<m){var g=t[c][a.location.y+f];$(g,a,e)}}function Z(a,b,c,d,e){for(var f=1;f<=b;f++)if(d){if(a.location.x+f<l){var g=t[a.location.x+f][c];$(g,a,e)}}else if(a.location.x-f>=0){var g=t[a.location.x-f][c];$(g,a,e)}}function $(a,b,c){a.occupied||c?a.isHighlightAttack=!0:a.isHighlightMove=!0}function _(){for(var a=0;a<l;a++)for(var b=0;b<m;b++)(t[a][b].isHighlightMove||t[a][b].isHighlightAttack)&&(t[a][b].isHighlightMove=!1,t[a][b].isHighlightAttack=!1)}function aa(a){Q=null,a.color="PC"===a.type?g:e,M.style.display="none",N.style.display="block",_()}function ba(){c.fillStyle=d,c.fillRect(b.offsetLeft,b.offsetTop,b.width,b.height)}function ca(){ba();for(var a=0;a<l;a++)for(var b=0;b<m;b++)c.fillStyle=t[a][b].color,c.fillRect(t[a][b].left,t[a][b].top,t[a][b].width,t[a][b].height),c.fillStyle="#000000",c.strokeRect(t[a][b].left,t[a][b].top,t[a][b].width,t[a][b].height);for(var a=0;a<A.length;a++)c.fillStyle=A[a].color,c.fillRect(A[a].left,A[a].top,A[a].width,A[a].height);for(var a=0;a<l;a++)for(var b=0;b<m;b++)(t[a][b].isHighlightAttack||t[a][b].isHighlightMove)&&(t[a][b].isHighlightMove&&(c.fillStyle=i),t[a][b].isHighlightAttack&&(c.fillStyle=j),c.fillRect(t[a][b].left,t[a][b].top,t[a][b].width,t[a][b].height),c.fillStyle="#000000",c.strokeRect(t[a][b].left,t[a][b].top,t[a][b].width,t[a][b].height))}function da(){}function ea(){da(),ca(),requestAnimationFrame(ea)}var b=document.getElementById("canvas"),c=b.getContext("2d"),d="#FFFFFF",e="#ffc107",f="#ffedb6",g="#d40dcb",h="#f7abf3",i="rgba(128, 145, 241, 0.6)",j="rgba(251, 34, 34, 0.6)",k=0,l=12,m=10,n=50,o=50,p=100,q=50,r="#18da39",t=[];u(l,m,n,o);var w={name:"dagger",damage:2},x={name:"rags",defense:1},y=B(t[0][0].left,t[0][0].top,n,o,e,"goblin",{x:0,y:0},"Goblin","10",4,w,x,!0);t[0][0].occupied=!0,t[0][0].occupiedType=y.type,t[0][0].gamePieceId=y.id;var z=B(t[1][1].left,t[1][1].top,n,o,g,"hero",{x:1,y:1},"Hero","12",4,w,x,!1);t[1][1].occupied=!0,t[1][1].occupiedType=z.type,t[1][1].gamePieceId=z.id;var A=new Array(y,z),E=(document.getElementById("gamePieceInfoCard"),document.getElementById("gamePieceName")),F=document.getElementById("gamePieceHealth"),G=document.getElementById("gamePieceAttack"),H=document.getElementById("gamePieceDefense"),I=document.getElementById("gamePieceWeapon"),J=document.getElementById("gamePieceArmor"),K=document.getElementById("gamePieceMovement"),L=document.getElementById("gamePieceHasMoved"),M=document.getElementById("gamePieceInfoDisplay"),N=document.getElementById("gamePieceInfoDisplayDefault"),O=document.getElementById("currentRound"),P=document.getElementById("endTurnBtn"),Q=null,R=document.getElementById("clientXoutput"),S=document.getElementById("clientYoutput"),T=document.getElementById("clickXoutput"),U=document.getElementById("clickYoutput");V(),requestAnimationFrame(ea)});